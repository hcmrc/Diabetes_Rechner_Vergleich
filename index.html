<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Diabetes Risikorechner (ARIC)</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #f8fafc; }
    .card { border-radius: 12px; }
    .form-control {
        display: block;
        width: 100%;
        padding: 0.5rem 0.75rem;
        font-size: 1rem;
        line-height: 1.5;
        color: #212529;
        background-color: #fff;
        border: 1px solid #ced4da;
        border-radius: 0.375rem;
        transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    }
    .form-control:focus {
        color: #212529;
        background-color: #fff;
        border-color: #86b7fe;
        outline: 0;
        box-shadow: 0 0 0 0.25rem rgb(13 110 253 / 25%);
    }
    .form-check-input {
        width: 1em;
        height: 1em;
        margin-top: 0.25em;
        vertical-align: top;
        border: 1px solid #ced4da;
        border-radius: 0.25em;
    }
    .btn {
        display: inline-block;
        font-weight: 400;
        line-height: 1.5;
        text-align: center;
        vertical-align: middle;
        cursor: pointer;
        user-select: none;
        background-color: transparent;
        border: 1px solid transparent;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        border-radius: 0.375rem;
        transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    }
    .btn-primary {
        color: #fff;
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
    .btn-primary:hover {
        background-color: #0b5ed7;
        border-color: #0a58ca;
    }
  </style>
</head>
<body class="p-6">
  <div class="max-w-3xl mx-auto">
    <div class="card p-6 shadow bg-white">
      <h1 class="text-2xl font-bold mb-2">Diabetes Risikorechner</h1>
     
      <form id="calcForm" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <label class="block">
          <span class="text-sm">Alter (Jahre)</span>
          <input id="age" type="number" class="form-control mt-1" value="54" />
        </label>

        <label class="block">
          <span class="text-sm">Nüchtern-Glukose (mmol/l)</span>
          <input id="fg" type="number" step="0.1" class="form-control mt-1" value="5.4" />
        </label>

        <label class="block">
          <span class="text-sm">Systolischer Blutdruck (mmHg)</span>
          <input id="sbp" type="number" class="form-control mt-1" value="120" />
        </label>

        <label class="block">
          <span class="text-sm">Taillenumfang (cm)</span>
          <input id="waist" type="number" class="form-control mt-1" value="95" />
        </label>

        <label class="block">
          <span class="text-sm">Körpergröße (cm)</span>
          <input id="height" type="number" class="form-control mt-1" value="168" />
        </label>

        <label class="block">
          <span class="text-sm">HDL Cholesterol (mmol/l)</span>
          <input id="hdl" type="number" step="0.1" class="form-control mt-1" value="1.2" />
        </label>

        <label class="block">
          <span class="text-sm">Triglyceride (mmol/l)</span>
          <input id="trig" type="number" step="0.1" class="form-control mt-1" value="1.3" />
        </label>

        <div class="flex items-center gap-2 mt-2">
          <input id="race" type="checkbox" class="form-check-input" />
          <label for="race" class="text-sm">African American (Black)</label>
        </div>

        <div class="flex items-center gap-2 mt-2">
          <input id="parent" type="checkbox" class="form-check-input" />
          <label for="parent" class="text-sm">Mindestens ein Elternteil mit Diabetes</label>
        </div>
      </form>

      <div class="mt-4">
        <button id="calcBtn" type="button" class="btn btn-primary">Berechnen</button>
      </div>
      
      <div class="mt-4 p-4 rounded-lg bg-gray-50">
        <div id="prob" class="text-3xl font-bold text-blue-600">—%</div>
        <div class="text-sm text-gray-600 mt-2">
          Score (Logit): <span id="score" class="font-medium">—</span>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  // --- Modell-Koeffizienten aus der ARIC-Studie (diabAll) ---
  const COEFF = {
    intercept: -9.9808,
    age: 0.0173,
    race: 0.4433,        // Koeffizient für "Black"
    parentHist: 0.4981,
    sbp: 0.0111,
    waist: 0.0273,
    height: -0.0326,      // Korrigiertes Vorzeichen
    fastGlu: 1.5849,
    cholHDL: -0.4718,     // Korrigiertes Vorzeichen
    cholTri: 0.242
  };

  // Hilfsfunktion zum Abrufen von Elementen
  const el = id => document.getElementById(id);

  // Liest alle Werte aus den Formularfeldern
  function readInputs() {
    return {
      age: parseFloat(el('age').value) || 0,
      fg: parseFloat(el('fg').value) || 0,
      sbp: parseFloat(el('sbp').value) || 0,
      waist: parseFloat(el('waist').value) || 0,
      height: parseFloat(el('height').value) || 0,
      hdl: parseFloat(el('hdl').value) || 0,
      trig: parseFloat(el('trig').value) || 0,
      race: el('race').checked ? 1 : 0,     // 1 wenn ja, 0 wenn nein
      parent: el('parent').checked ? 1 : 0  // 1 wenn ja, 0 wenn nein
    };
  }

  // Berechnet den Logit-Score
  function calculateScore(v) {
    return COEFF.intercept
      + (COEFF.age * v.age)
      + (COEFF.race * v.race)
      + (COEFF.parentHist * v.parent)
      + (COEFF.sbp * v.sbp)
      + (COEFF.waist * v.waist)
      + (COEFF.height * v.height)
      + (COEFF.fastGlu * v.fg)
      + (COEFF.cholHDL * v.hdl)
      + (COEFF.cholTri * v.trig);
  }

  // Logistische Funktion (Sigmoid)
  function logistic(x) {
    return 1 / (1 + Math.exp(-x));
  }

  // Hauptfunktion zum Aktualisieren der Ergebnisse
  function updateResults() {
    const values = readInputs();
    const score = calculateScore(values);
    const probability = logistic(score);

    // Ergebnisse in der UI anzeigen
    el('score').textContent = score.toFixed(4);
    el('prob').textContent = (probability * 100).toFixed(1) + '%';
  }

  // Event Listener für den Button
  el('calcBtn').addEventListener('click', updateResults);

  // Führt eine erste Berechnung beim Laden der Seite durch
  updateResults();
})();
</script>

</body>
</html>